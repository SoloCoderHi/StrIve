<!DOCTYPE html>
<html>
<head>
    <title>IMDb API Test</title>
</head>
<body>
    <h1>IMDb API Test</h1>
    <button onclick="testIMDb()">Test IMDb API for Game of Thrones (TMDB: 1399)</button>
    <pre id="output"></pre>

    <script type="module">
        // Test getting IMDb ID from TMDB
        async function getTMDBExternalIds(tmdbId) {
            const url = `https://api.themoviedb.org/3/tv/${tmdbId}/external_ids`;
            const response = await fetch(url, {
                headers: {
                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIxMjk4NjA2MjkxMDQ1ZjVkNzhmY2MzZWEwZmQ0NWQ5ZSIsIm5iZiI6MTcxNzk0MzQwNy4wMjcsInN1YiI6IjY2NjViYzZmN2YzZjVmY2IxZTljZmRjMiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.1S9pDxmhqSMVsi2Ez_bi7YH9kWXsR8zkg1N94l0tdwY'
                }
            });
            const data = await response.json();
            return data.imdb_id;
        }

        async function getIMDbRating(imdbId) {
            const url = `https://api.imdbapi.dev/titles/${imdbId}`;
            const response = await fetch(url);
            const data = await response.json();
            return data;
        }

        window.testIMDb = async function() {
            const output = document.getElementById('output');
            try {
                output.textContent = 'Step 1: Getting IMDb ID from TMDB for Game of Thrones (1399)...\n';
                
                const imdbId = await getTMDBExternalIds(1399);
                output.textContent += `‚úÖ IMDb ID: ${imdbId}\n\n`;
                
                output.textContent += 'Step 2: Fetching IMDb data...\n';
                const imdbData = await getIMDbRating(imdbId);
                
                output.textContent += `‚úÖ IMDb Data:\n`;
                output.textContent += JSON.stringify(imdbData, null, 2);
                output.textContent += `\n\nüìä Rating: ${imdbData.rating?.aggregateRating}/10\n`;
                output.textContent += `üë• Votes: ${imdbData.rating?.voteCount?.toLocaleString()}\n`;
            } catch (error) {
                output.textContent += `\n‚ùå Error: ${error.message}\n${error.stack}`;
            }
        };
    </script>
</body>
</html>
